pub(all) type Board[T] Array[Array[T]]

pub fn Board::height[T](self: Board[T]) -> Int {
  self._.length()
}

pub fn Board::width[T](self: Board[T]) -> Int {
  self._[0].length()
}

pub fn Board::out_of_bound[T](self: Board[T], tup: (Int, Int)) -> Bool {
  let (x, y) = tup
  x < 0 || x >= self.width() || y < 0 || y >= self.height()
}

pub fn Board::get2[T](self: Board[T], tup: (Int, Int)) -> Option[T] {
  let (x, y) = tup
  if not(self.out_of_bound((x, y))) { Some(self._[y][x]) }
  else { None }
}

pub fn Board::set2[T](self: Board[T], tup: (Int, Int), v: T) -> Bool {
  let (x, y) = tup
  if not(self.out_of_bound((x, y))) { self._[y][x] = v; true }
  else { false }
}

pub fn Board::add(tup1: (Int, Int), tup2: (Int, Int)) -> (Int, Int) {
  (tup1.0 + tup2.0, tup1.1 + tup2.1)
}

pub fn Board::each[T, R](self: Board[T], init: R, action: ((T, R) -> R)) -> R {
  let mut acc = init
  for i in 0..<self.width() {
    for j in 0..<self.height() {
      acc = action(self._[j][i], acc)
    }
  }
  acc
}

pub fn Board::eachi[T, R](self: Board[T], init: R, action: ((T, R, (Int, Int)) -> R)) -> R {
  let mut acc = init
  for i in 0..<self.width() {
    for j in 0..<self.height() {
      acc = action(self._[j][i], acc, (i, j))
    }
  }
  acc
}

test "use board" {
  let board: Board[Int] = [[1, 2], [3, 4]]
  assert_eq!(board.get2((1, 1)), Some(4))
  assert_eq!(board.get2((2, 2)), None)
  assert_eq!(board.set2((1, 1), 5), true)
  assert_eq!(board.each(0, fn { a, b => a + b }), 11)
}

fn parse(s: String) -> Int64 { @strconv.parse_int64?(s.to_string()).unwrap() }
fn parsec(s: Char) -> Int64 { @strconv.parse_int64?(s.to_string()).unwrap() }
fn part1(input: String, limit: Int) -> Int64 {
  let board: Board[Char] = input.split("\n").map(fn(s) { s.to_array() }).collect()
  let start = board.eachi(None, fn(ch, res, loc) { if ch == 'S' { Some(loc) } else { res }}).unwrap()
  let end = board.eachi(None, fn(ch, res, loc) { if ch == 'E' { Some(loc) } else { res }}).unwrap()
  let path = loop start, [start] {
    mid, res => {
      if mid == end { break res }
      let (nex, res) = for dir in [(0, 1), (0, -1), (1, 0), (-1, 0)] {
        let nex_loc = Board::add(mid, dir)
        if res.contains(nex_loc) { continue }
        let nex = board.get2(nex_loc)
        if nex != None && nex != Some('#') { break (Board::add(mid, dir), res..push(Board::add(mid, dir))) }
      } else { panic() }
      continue nex, res
    }
  }
  let pairs = path.map(fn(loc) {
    [(0, 2), (0, -2), (2, 0), (-2, 0), (1, 1), (1, -1), (-1, 1), (-1, 1)]
      .map(fn(dir) { Board::add(loc, dir) })
      .filter(fn(it) { path.contains(it) && board.get2(((loc.0 + it.0)/2, (loc.1 + it.1)/2)) == Some('#') })
      .map(fn(it) { (loc, it) })
  }).flatten()
  let shortcuts = pairs.map(fn { (from, to) => {
    path.search(to).unwrap() - path.search(from).unwrap()
  }})
  shortcuts.filter(fn(it) { it >= limit + 2 }).length().to_int64()
}

test "day20_part1_test" {
  let input = #|###############
    #|#...#...#.....#
    #|#.#.#.#.#.###.#
    #|#S#...#.#.#...#
    #|#######.#.#.###
    #|#######.#.#...#
    #|#######.#.###.#
    #|###..E#...#...#
    #|###.#######.###
    #|#...###...#...#
    #|#.#####.#.###.#
    #|#.#...#.#.#...#
    #|#.#.#.#.#.#.###
    #|#...#...#...###
    #|###############

  assert_eq!(part1(input, 30), 4)
}

test "day20_part1_examine" {
  let input = #|#############################################################################################################################################
    #|#...#...#...#...#...#.....###...###...#...#.....#...#...#...###...#...........#...###.....#...#.........#...#.....#.....#...#.....###...#...#
    #|#.#.#.#.#.#.#.#.#.#.#.###.###.#.###.#.#.#.#.###.#.#.#.#.#.#.###.#.#.#########.#.#.###.###.#.#.#.#######.#.#.#.###.#.###.#.#.#.###.###.#.#.#.#
    #|#.#.#.#.#.#.#.#.#.#.#.#...#...#.....#.#.#.#...#...#.#.#.#.#...#.#.#.#.........#.#...#.#...#.#...#.......#.#.#.#...#...#.#.#.#...#.....#...#.#
    #|#.#.#.#.#.#.#.#.#.#.#.#.###.#########.#.#.###.#####.#.#.#.###.#.#.#.#.#########.###.#.#.###.#####.#######.#.#.#.#####.#.#.#.###.###########.#
    #|#.#...#...#.#.#...#.#.#...#.........#.#.#...#.....#.#.#.#.#...#.#.#.#.###...###.#...#.#...#.#.....#.....#.#.#.#.#####.#.#.#...#.#...........#
    #|#.#########.#.#####.#.###.#########.#.#.###.#####.#.#.#.#.#.###.#.#.#.###.#.###.#.###.###.#.#.#####.###.#.#.#.#.#####.#.#.###.#.#.###########
    #|#.#...#...#.#.#...#.#.#...#...#...#.#.#.#...###...#.#.#...#.#...#.#.#...#.#.#...#...#...#.#.#.#...#...#.#.#.#.#...#...#.#.#...#.#.###...#...#
    #|#.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#####.###.#.#####.#.###.#.###.#.#.#.#####.###.#.#.#.#.#.###.#.#.#.#.###.#.###.#.#.###.#.###.#.#.#.#
    #|#.#.#...#.#.#.#.#...#.#.#...#.#.#.#.#...#.#...#...#.#.....#.#...#...#...#.#...#.....#...#.#.#.#.#.#...#...#.#...#.#...#.#.#.#...#...#.#.#.#.#
    #|#.#.#####.#.#.#.#####.#.#.###.#.#.#.#####.#.#.###.#.#####.#.###.#####.###.#####.#####.###.#.#.#.#.#.#######.###.#.###.#.#.#.#.#####.#.#.#.#.#
    #|#.#.#.....#...#...#...#.#...#.#.#.#.#.....#.#.#...#...#...#...#.....#...#.....#.#...#...#...#.#.#...#.......###.#.#...#...#...#...#...#...#.#
    #|#.#.#.###########.#.###.###.#.#.#.#.#.#####.#.#.#####.#.#####.#####.###.#####.#.#.#.###.#####.#.#####.#########.#.#.###########.#.#########.#
    #|#...#...........#.#.#...#...#...#...#...###.#.#...#...#.....#.#.....#...#.....#.#.#.....#.....#.....#.......#...#.#.#...#...#...#...........#
    #|###############.#.#.#.###.#############.###.#.###.#.#######.#.#.#####.###.#####.#.#######.#########.#######.#.###.#.#.#.#.#.#.###############
    #|#...###.........#.#.#...#.......#.....#.....#.#...#.....#...#.#.....#.###.....#...#.......#...#...#.#.......#...#.#.#.#...#.#...###...#...###
    #|#.#.###.#########.#.###.#######.#.###.#######.#.#######.#.###.#####.#.#######.#####.#######.#.#.#.#.#.#########.#.#.#.#####.###.###.#.#.#.###
    #|#.#...#.........#.#...#.#.....#...###.......#.#.#.......#...#.....#.#...#...#.....#.......#.#.#.#.#.#...#.....#.#...#.....#.....#...#...#...#
    #|#.###.#########.#.###.#.#.###.#############.#.#.#.#########.#####.#.###.#.#.#####.#######.#.#.#.#.#.###.#.###.#.#########.#######.#########.#
    #|#...#.#...#...#.#.###.#.#...#.#...###...#...#...#...#...###.....#...#...#.#...#...#.......#.#...#.#...#.#...#.#...#.......#...#...#.........#
    #|###.#.#.#.#.#.#.#.###.#.###.#.#.#.###.#.#.#########.#.#.#######.#####.###.###.#.###.#######.#####.###.#.###.#.###.#.#######.#.#.###.#########
    #|#...#...#.#.#...#...#.#.#...#.#.#.#...#.#.......#...#.#...#.....#.....###...#...#...#...###.#.....###.#.###.#.#...#.#...###.#.#.#...#...#...#
    #|#.#######.#.#######.#.#.#.###.#.#.#.###.#######.#.###.###.#.#####.#########.#####.###.#.###.#.#######.#.###.#.#.###.#.#.###.#.#.#.###.#.#.#.#
    #|#.#.....#.#.......#...#.#...#.#.#.#.#...#.......#...#.#...#.....#.#.....###...#...#...#.....#.#.....#.#.#...#.#...#...#.#...#...#.....#...#.#
    #|#.#.###.#.#######.#####.###.#.#.#.#.#.###.#########.#.#.#######.#.#.###.#####.#.###.#########.#.###.#.#.#.###.###.#####.#.#################.#
    #|#.#.#...#.....###.....#.###.#.#.#.#.#.###.......#...#.#...#.....#.#.#...#...#.#...#.....#.....#...#.#.#.#...#.#...#.....#.#.........#...#...#
    #|#.#.#.#######.#######.#.###.#.#.#.#.#.#########.#.###.###.#.#####.#.#.###.#.#.###.#####.#.#######.#.#.#.###.#.#.###.#####.#.#######.#.#.#.###
    #|#.#.#.......#.#.....#.#.#...#.#.#.#.#.#...###...#.###.#...#.....#...#...#.#.#.#...#...#.#.#...#...#...#...#.#...#...#.....#.......#.#.#.#...#
    #|#.#.#######.#.#.###.#.#.#.###.#.#.#.#.#.#.###.###.###.#.#######.#######.#.#.#.#.###.#.#.#.#.#.#.#########.#.#####.###.###########.#.#.#.###.#
    #|#.#.###...#.#.#.#...#.#...#...#.#.#.#.#.#.#...#...#...#.#...#...#.......#.#.#.#.###.#.#.#.#.#.#.........#...#...#.....#.....#.....#...#...#.#
    #|#.#.###.#.#.#.#.#.###.#####.###.#.#.#.#.#.#.###.###.###.#.#.#.###.#######.#.#.#.###.#.#.#.#.#.#########.#####.#.#######.###.#.###########.#.#
    #|#.#.#...#...#...#...#.....#.#...#.#.#.#.#.#...#...#.#...#.#...#...#.....#.#.#.#...#.#.#.#.#.#.#.....#...#.....#...#.....###.#...........#...#
    #|#.#.#.#############.#####.#.#.###.#.#.#.#.###.###.#.#.###.#####.###.###.#.#.#.###.#.#.#.#.#.#.#.###.#.###.#######.#.#######.###########.#####
    #|#.#.#...#.......#...#...#.#.#...#.#.#.#.#.###...#.#.#.###.....#.###...#.#.#.#.#...#.#.#.#.#.#.#...#.#...#...#...#...#.....#.#...#.......#...#
    #|#.#.###.#.#####.#.###.#.#.#.###.#.#.#.#.#.#####.#.#.#.#######.#.#####.#.#.#.#.#.###.#.#.#.#.#.###.#.###.###.#.#.#####.###.#.#.#.#.#######.#.#
    #|#.#.###...#.....#.....#...#.....#...#.#.#...#...#.#.#.#...#...#.#...#.#.#.#...#...#.#.#.#.#.#...#.#.#...#...#.#.#...#...#.#...#...#.......#.#
    #|#.#.#######.#########################.#.###.#.###.#.#.#.#.#.###.#.#.#.#.#.#######.#.#.#.#.#.###.#.#.#.###.###.#.#.#.###.#.#########.#######.#
    #|#.#.#.......#.....#...#...#.....#...#...###.#.###.#.#.#.#...###.#.#.#.#.#.....#...#.#...#.#.#...#.#.#.###.....#...#.#...#...#.....#...#.....#
    #|#.#.#.#######.###.#.#.#.#.#.###.#.#.#######.#.###.#.#.#.#######.#.#.#.#.#####.#.###.#####.#.#.###.#.#.#############.#.#####.#.###.###.#.#####
    #|#...#.........###...#...#...###...#.......#.#...#.#.#.#.....#...#.#...#.#...#.#...#...#...#.#.....#...#.............#.#.....#.#...#...#.....#
    #|#########################################.#.###.#.#.#.#####.#.###.#####.#.#.#.###.###.#.###.###########.#############.#.#####.#.###.#######.#
    #|#.........................#...............#.....#...#.#.....#...#.....#.#.#.#.#...#...#...#...#.......#...............#...#...#...#.#.......#
    #|#.#######################.#.#########################.#.#######.#####.#.#.#.#.#.###.#####.###.#.#####.###################.#.#####.#.#.#######
    #|#.......#...#...#.......#.#.#.................#.......#.......#.#...#.#.#.#.#.#...#.#...#.#...#.#...#...........#...#...#...#...#...#.......#
    #|#######.#.#.#.#.#.#####.#.#.#.###############.#.#############.#.#.#.#.#.#.#.#.###.#.#.#.#.#.###.#.#.###########.#.#.#.#.#####.#.###########.#
    #|#...###...#...#.#.#...#.#.#...#.........#.....#.....#.........#.#.#...#.#.#...#...#...#.#.#...#...#.......#...#...#.#.#.#.....#...........#.#
    #|#.#.###########.#.#.#.#.#.#####.#######.#.#########.#.#########.#.#####.#.#####.#######.#.###.###########.#.#.#####.#.#.#.###############.#.#
    #|#.#.#...#.......#.#.#...#.......#.....#.#.....#.....#.......#...#.#.....#...#...#.....#.#.#...#.....#...#...#.....#.#.#.#.............#...#.#
    #|#.#.#.#.#.#######.#.#############.###.#.#####.#.###########.#.###.#.#######.#.###.###.#.#.#.###.###.#.#.#########.#.#.#.#############.#.###.#
    #|#.#...#.#.........#.#...#.........#...#.......#.....#...#...#.#...#...###E#.#...#...#.#.#...###...#.#.#.....#.....#...#.........#...#.#...#.#
    #|#.#####.###########.#.#.#.#########.###############.#.#.#.###.#.#####.###.#.###.###.#.#.#########.#.#.#####.#.#################.#.#.#.###.#.#
    #|#...#...#...#.......#.#.#.#.........#...#...#...#...#.#.#...#.#.#.....###.#.#...#...#...#...#...#.#...#...#...#...#...#.......#.#.#...###...#
    #|###.#.###.#.#.#######.#.#.#.#########.#.#.#.#.#.#.###.#.###.#.#.#.#######.#.#.###.#######.#.#.#.#.#####.#.#####.#.#.#.#.#####.#.#.###########
    #|#...#.#...#...#.......#.#.#...........#...#...#.#...#.#.#...#.#.#.#...###.#.#...#.#.......#...#...#.....#.......#...#...#.....#.#...........#
    #|#.###.#.#######.#######.#.#####################.###.#.#.#.###.#.#.#.#.###.#.###.#.#.###############.#####################.#####.###########.#
    #|#...#.#.........#...###...#.......#...#.........###.#.#.#.###.#.#...#.###...###...#...#.......#.....#.......#.............###...#.....#.....#
    #|###.#.###########.#.#######.#####.#.#.#.###########.#.#.#.###.#.#####.###############.#.#####.#.#####.#####.#.###############.###.###.#.#####
    #|#...#.#.........#.#.#...###.....#.#.#.#...........#.#.#.#...#.#.#.....#########...###...#...#...#...#.....#...#...###...#...#.....###...#...#
    #|#.###.#.#######.#.#.#.#.#######.#.#.#.###########.#.#.#.###.#.#.#.#############.#.#######.#.#####.#.#####.#####.#.###.#.#.#.#############.#.#
    #|#...#.#...#...#...#.#.#.#.....#.#...#.........#...#...#.#...#.#.#.###########...#...#.....#.......#.....#.......#.....#...#...............#.#
    #|###.#.###.#.#.#####.#.#.#.###.#.#############.#.#######.#.###.#.#.###########.#####.#.#################.###################################.#
    #|#...#...#...#.....#.#.#.#...#.#.............#.#.###...#...#...#.#.###########.....#.#.......#.........#.#.........#.........................#
    #|#.#####.#########.#.#.#.###.#.#############.#.#.###.#.#####.###.#.###############.#.#######.#.#######.#.#.#######.#.#########################
    #|#.#...#...#.......#.#.#.#...#...........#...#.#.....#.....#...#.#.###########.....#...#.....#.###.....#...#...###...#.......#...#...###...###
    #|#.#.#.###.#.#######.#.#.#.#############.#.###.###########.###.#.#.###########.#######.#.#####.###.#########.#.#######.#####.#.#.#.#.###.#.###
    #|#...#...#.#.......#...#...#...........#.#...#.#.....#...#...#.#.#.###########.....#...#.....#...#.#...#...#.#.#.....#.#...#...#...#.....#...#
    #|#######.#.#######.#########.#########.#.###.#.#.###.#.#.###.#.#.#.###############.#.#######.###.#.#.#.#.#.#.#.#.###.#.#.#.#################.#
    #|#...#...#.........#...#...#.#.........#.....#.#...#.#.#.#...#.#.#.#####...........#.....###.....#.#.#...#...#.#.#...#.#.#...........#...#...#
    #|#.#.#.#############.#.#.#.#.#.###############.###.#.#.#.#.###.#.#.#####.###############.#########.#.#########.#.#.###.#.###########.#.#.#.###
    #|#.#.#.....#...#.....#.#.#.#.#.#.............#.#...#...#...###.#.#S#####...............#...#.....#...#...#.....#.#.....#...........#.#.#.#...#
    #|#.#.#####.#.#.#.#####.#.#.#.#.#.###########.#.#.#############.#.#####################.###.#.###.#####.#.#.#####.#################.#.#.#.###.#
    #|#.#.......#.#.#.#.....#.#.#.#.#.#...........#...#...#...#...#...#.....###...###...###...#.#...#.#...#.#...#...#.#.............#...#.#.#...#.#
    #|#.#########.#.#.#.#####.#.#.#.#.#.###############.#.#.#.#.#.#####.###.###.#.###.#.#####.#.###.#.#.#.#.#####.#.#.#.###########.#.###.#.###.#.#
    #|#.........#.#...#.......#...#...#.................#.#.#...#...###...#.#...#.#...#.......#.#...#...#...#.....#...#.#.........#...###...###...#
    #|#########.#.#######################################.#.#######.#####.#.#.###.#.###########.#.###########.#########.#.#######.#################
    #|#...###...#.#...............#...........#...........#.#.......#...#.#.#...#.#.....#.....#.#.............#...#...#...#...#...###...#.........#
    #|#.#.###.###.#.#############.#.#########.#.###########.#.#######.#.#.#.###.#.#####.#.###.#.###############.#.#.#.#####.#.#.#####.#.#.#######.#
    #|#.#.....#...#.....#...#...#...#.....###...#.........#.#.....###.#.#.#.....#...###.#...#.#.......#.........#...#.#.....#...#...#.#.#...#...#.#
    #|#.#######.#######.#.#.#.#.#####.###.#######.#######.#.#####.###.#.#.#########.###.###.#.#######.#.#############.#.#########.#.#.#.###.#.#.#.#
    #|#.#...#...#.......#.#...#.......#...#.......#.....#...#.....#...#...#...#...#.#...#...#...#...#...#...#.....#...#...........#...#.###.#.#...#
    #|#.#.#.#.###.#######.#############.###.#######.###.#####.#####.#######.#.#.#.#.#.###.#####.#.#.#####.#.#.###.#.###################.###.#.#####
    #|#.#.#...###.........#.....#...###...#.#.......###.......#...#.........#...#.#.#.#...#...#...#.#...#.#...#...#.#.....#.......#...#.....#.....#
    #|#.#.#################.###.#.#.#####.#.#.#################.#.###############.#.#.#.###.#.#####.#.#.#.#####.###.#.###.#.#####.#.#.###########.#
    #|#...#.........###...#...#...#.....#...#.............#.....#.#...#...###...#.#.#...###.#...#...#.#.#.#.....###...#...#...###...#.....#.......#
    #|#####.#######.###.#.###.#########.#################.#.#####.#.#.#.#.###.#.#.#.#######.###.#.###.#.#.#.###########.#####.###########.#.#######
    #|#...#.......#.....#.#...#...#...#.#...#...#.........#.#.....#.#.#.#...#.#...#.......#.#...#.....#...#.........###.......#...###...#...###...#
    #|#.#.#######.#######.#.###.#.#.#.#.#.#.#.#.#.#########.#.#####.#.#.###.#.###########.#.#.#####################.###########.#.###.#.#######.#.#
    #|#.#.#...###.......#.#.....#...#.#...#...#...#...#...#.#.#...#.#.#...#.#...#.........#.#.#...#...............#.......#...#.#.#...#...#...#.#.#
    #|#.#.#.#.#########.#.###########.#############.#.#.#.#.#.#.#.#.#.###.#.###.#.#########.#.#.#.#.#############.#######.#.#.#.#.#.#####.#.#.#.#.#
    #|#.#.#.#.#...#...#.#...#.....###...........###.#.#.#.#.#.#.#.#.#...#.#.###.#.....#...#.#.#.#.#.............#.........#.#.#.#.#.#.....#.#...#.#
    #|#.#.#.#.#.#.#.#.#.###.#.###.#############.###.#.#.#.#.#.#.#.#.###.#.#.###.#####.#.#.#.#.#.#.#############.###########.#.#.#.#.#.#####.#####.#
    #|#.#.#.#.#.#.#.#...#...#...#.#.............#...#...#.#.#...#.#.#...#.#.#...#.....#.#.#.#...#...........#...#...#...###.#.#.#...#.......#.....#
    #|#.#.#.#.#.#.#.#####.#####.#.#.#############.#######.#.#####.#.#.###.#.#.###.#####.#.#.###############.#.###.#.#.#.###.#.#.#############.#####
    #|#.#.#.#.#.#.#.....#.#...#.#...#...........#...#...#.#.#...#...#...#.#.#...#.#...#.#.#.#...#.........#.#.....#...#.....#...#...#.........#...#
    #|#.#.#.#.#.#.#####.#.#.#.#.#####.#########.###.#.#.#.#.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#.#######.#.#####################.#.#.#########.#.#
    #|#.#...#...#.....#.#...#...#...#.###.......#...#.#...#...#.#...#...#.#.#...#.#.#.#.#.#...#...#.....#.#.......................#.#.#.......#.#.#
    #|#.#############.#.#########.#.#.###.#######.###.#########.#.#.#.###.#.#.###.#.#.#.#.#########.###.#.#########################.#.#.#####.#.#.#
    #|#.#...#...#...#...#...#...#.#.#.#...#...###...#...#.....#.#.#...#...#.#...#.#.#...#...#.....#...#.#...............#.........#.#...#.....#.#.#
    #|#.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.###.#.#####.###.#.###.#.#.#####.###.###.#.#.#######.#.###.###.#.###############.#.#######.#.#####.#####.#.#
    #|#.#.#.#.#...#.....#.#.#.#.#.#...#.....#.#.....#...#...#.#.#.....#...#.#...#.#.#.......#...#.....#.#.........#...#...#...#...#.#...#.......#.#
    #|#.#.#.#.#########.#.#.#.#.#.###########.#.#####.#####.#.#.#####.###.#.#.###.#.#.#########.#######.#.#######.#.#.#####.#.#.###.#.#.#########.#
    #|#.#.#...#...#.....#.#...#...###.........#...#...###...#.#.#.....#...#.#.#...#.#...#.....#.......#.#.......#...#.......#...#...#.#.#.....#...#
    #|#.#.#####.#.#.#####.###########.###########.#.#####.###.#.#.#####.###.#.#.###.###.#.###.#######.#.#######.#################.###.#.#.###.#.###
    #|#...###...#...#...#.#...........#...#...###.#.#...#...#.#.#.#...#...#.#.#.###.#...#.#...#...###.#.#...###.................#.#...#.#.###.#...#
    #|#######.#######.#.#.#.###########.#.#.#.###.#.#.#.###.#.#.#.#.#.###.#.#.#.###.#.###.#.###.#.###.#.#.#.###################.#.#.###.#.###.###.#
    #|#.......#...#...#...#...#...#.....#.#.#.#...#.#.#.....#.#.#.#.#.#...#.#.#.#...#.#...#...#.#.#...#...#.#.......#...........#...###.#...#.#...#
    #|#.#######.#.#.#########.#.#.#.#####.#.#.#.###.#.#######.#.#.#.#.#.###.#.#.#.###.#.#####.#.#.#.#######.#.#####.#.#################.###.#.#.###
    #|#.#.....#.#.#.#.......#...#...#.....#.#.#.#...#...###...#.#.#.#.#.#...#.#.#...#.#.....#.#.#.#.#.......#.....#.#.............#...#.....#.#...#
    #|#.#.###.#.#.#.#.#####.#########.#####.#.#.#.#####.###.###.#.#.#.#.#.###.#.###.#.#####.#.#.#.#.#.###########.#.#############.#.#.#######.###.#
    #|#...#...#.#...#.....#.........#...#...#.#.#.#...#...#...#.#.#.#...#...#.#.#...#...#...#.#.#...#.#.....#.....#.#...#.......#...#.###...#.....#
    #|#####.###.#########.#########.###.#.###.#.#.#.#.###.###.#.#.#.#######.#.#.#.#####.#.###.#.#####.#.###.#.#####.#.#.#.#####.#####.###.#.#######
    #|###...#...###...###.....#...#.....#.###...#.#.#...#...#.#.#.#...#.....#.#.#.###...#.#...#.#.....#.#...#.....#.#.#.#...###.......#...#...#...#
    #|###.###.#####.#.#######.#.#.#######.#######.#.###.###.#.#.#.###.#.#####.#.#.###.###.#.###.#.#####.#.#######.#.#.#.###.###########.#####.#.#.#
    #|#...#...#...#.#.#.......#.#...#...#.......#.#.#...#...#.#.#.#...#.#...#.#.#.#...#...#.#...#.#...#.#...#.....#.#.#...#.............#...#...#.#
    #|#.###.###.#.#.#.#.#######.###.#.#.#######.#.#.#.###.###.#.#.#.###.#.#.#.#.#.#.###.###.#.###.#.#.#.###.#.#####.#.###.###############.#.#####.#
    #|#...#.#...#...#...#...#...###.#.#.#...#...#.#.#...#...#.#.#.#.###.#.#.#.#.#.#...#.#...#.###...#.#.#...#.....#.#...#...#...#.....#...#.#.....#
    #|###.#.#.###########.#.#.#####.#.#.#.#.#.###.#.###.###.#.#.#.#.###.#.#.#.#.#.###.#.#.###.#######.#.#.#######.#.###.###.#.#.#.###.#.###.#.#####
    #|#...#.#.#...#...#...#.#.#.....#.#.#.#...#...#.#...#...#.#.#.#...#.#.#.#.#.#.#...#.#...#.......#.#.#.#...#...#.....###...#.#...#.#.###.#.....#
    #|#.###.#.#.#.#.#.#.###.#.#.#####.#.#.#####.###.#.###.###.#.#.###.#.#.#.#.#.#.#.###.###.#######.#.#.#.#.#.#.###############.###.#.#.###.#####.#
    #|#...#.#...#.#.#.#...#...#.#...#.#.#.....#.....#...#...#.#.#.#...#...#...#...#.#...#...#.......#...#...#.#.........#.....#.#...#.#...#.#.....#
    #|###.#.#####.#.#.###.#####.#.#.#.#.#####.#########.###.#.#.#.#.###############.#.###.###.###############.#########.#.###.#.#.###.###.#.#.#####
    #|#...#.#.....#.#.#...#.....#.#.#.#.#...#.......#...#...#.#.#.#.#.......#.......#...#...#.....###...###...#.........#.#...#.#...#.#...#.#.....#
    #|#.###.#.#####.#.#.###.#####.#.#.#.#.#.#######.#.###.###.#.#.#.#.#####.#.#########.###.#####.###.#.###.###.#########.#.###.###.#.#.###.#####.#
    #|#.....#.....#.#.#.#...#.....#.#.#.#.#.#.......#...#...#.#.#.#...#.....#.....#...#.###.....#.....#...#...#...#.......#.###.#...#...###.#...#.#
    #|###########.#.#.#.#.###.#####.#.#.#.#.#.#########.###.#.#.#.#####.#########.#.#.#.#######.#########.###.###.#.#######.###.#.#########.#.#.#.#
    #|#.......#...#.#.#.#...#.#.....#.#.#.#.#.........#.#...#.#.#.....#.....###...#.#.#.#.......#.....#...###...#.#.#.....#...#...#.........#.#...#
    #|#.#####.#.###.#.#.###.#.#.#####.#.#.#.#########.#.#.###.#.#####.#####.###.###.#.#.#.#######.###.#.#######.#.#.#.###.###.#####.#########.#####
    #|#.....#.#.....#...#...#.#...#...#...#...#.....#.#.#...#.#.....#.....#.#...#...#.#.#...#...#.###.#...#.....#...#...#...#...###.........#.....#
    #|#####.#.###########.###.###.#.#########.#.###.#.#.###.#.#####.#####.#.#.###.###.#.###.#.#.#.###.###.#.###########.###.###.###########.#####.#
    #|###...#...#...###...#...###.#.#.........#.###...#...#.#...#...###...#.#...#...#.#.#...#.#.#.#...#...#.....#.......###...#...###...###.#.....#
    #|###.#####.#.#.###.###.#####.#.#.#########.#########.#.###.#.#####.###.###.###.#.#.#.###.#.#.#.###.#######.#.###########.###.###.#.###.#.#####
    #|#...#...#...#.....#...#.....#.#.........#.......#...#...#.#.....#...#...#.#...#.#.#...#.#...#.#...#.....#.#...........#...#.....#...#.#.....#
    #|#.###.#.###########.###.#####.#########.#######.#.#####.#.#####.###.###.#.#.###.#.###.#.#####.#.###.###.#.###########.###.#########.#.#####.#
    #|#.....#...#.....#...###...#...#.........#.....#.#.#.....#.....#...#...#.#.#.###...#...#.....#.#...#...#...#.....#...#...#.#.......#.#.#...#.#
    #|#########.#.###.#.#######.#.###.#########.###.#.#.#.#########.###.###.#.#.#.#######.#######.#.###.###.#####.###.#.#.###.#.#.#####.#.#.#.#.#.#
    #|#.........#...#.#.#.......#.###.........#...#.#.#.#.........#.....###.#.#...#...###...#.....#.#...#...#...#...#.#.#.#...#.#.....#.#.#...#.#.#
    #|#.###########.#.#.#.#######.###########.###.#.#.#.#########.#########.#.#####.#.#####.#.#####.#.###.###.#.###.#.#.#.#.###.#####.#.#.#####.#.#
    #|#.#...#...#...#.#.#...#...#.#...........#...#.#.#...#.....#.........#.#.#.....#.......#.....#.#...#...#.#.#...#.#.#.#...#.#...#.#.#.....#.#.#
    #|#.#.#.#.#.#.###.#.###.#.#.#.#.###########.###.#.###.#.###.#########.#.#.#.#################.#.###.###.#.#.#.###.#.#.###.#.#.#.#.#.#####.#.#.#
    #|#...#...#...###...###...#...#.............###...###...###...........#...#...................#.....###...#...###...#.....#...#...#.......#...#
    #|#############################################################################################################################################
  inspect!(part1(input, 100), content="1497")
}

fn part2(input: String, limit: Int) -> Int64 {
    let board: Board[Char] = input.split("\n").map(fn(s) { s.to_array() }).collect()
  let start = board.eachi(None, fn(ch, res, loc) { if ch == 'S' { Some(loc) } else { res }}).unwrap()
  let end = board.eachi(None, fn(ch, res, loc) { if ch == 'E' { Some(loc) } else { res }}).unwrap()
  let path = loop start, [start] {
    mid, res => {
      if mid == end { break res }
      let (nex, res) = for dir in [(0, 1), (0, -1), (1, 0), (-1, 0)] {
        let nex_loc = Board::add(mid, dir)
        if res.contains(nex_loc) { continue }
        let nex = board.get2(nex_loc)
        if nex != None && nex != Some('#') { break (Board::add(mid, dir), res..push(Board::add(mid, dir))) }
      } else { panic() }
      continue nex, res
    }
  }
  let cheats = []
  for s in path {
    for e in path {
      let duration = @int.abs(s.0 - e.0) + @int.abs(s.1 - e.1)
      if s != e && duration <= 20 {
        cheats.push((s, e, duration))
      }
    }
  }
  let shortcuts = cheats.map(fn { (from, to, t) => {
    path.search(to).unwrap() - path.search(from).unwrap() - t
  }})
  shortcuts.filter(fn(it) { it >= limit }).length().to_int64()
}

test "day20_part2_test" {
  let input = #|###############
    #|#...#...#.....#
    #|#.#.#.#.#.###.#
    #|#S#...#.#.#...#
    #|#######.#.#.###
    #|#######.#.#...#
    #|#######.#.###.#
    #|###..E#...#...#
    #|###.#######.###
    #|#...###...#...#
    #|#.#####.#.###.#
    #|#.#...#.#.#...#
    #|#.#.#.#.#.#.###
    #|#...#...#...###
    #|###############

  assert_eq!(part2(input, 70), 41)
}

test "day20_part2_examine" {
  let input = #|#############################################################################################################################################
    #|#...#...#...#...#...#.....###...###...#...#.....#...#...#...###...#...........#...###.....#...#.........#...#.....#.....#...#.....###...#...#
    #|#.#.#.#.#.#.#.#.#.#.#.###.###.#.###.#.#.#.#.###.#.#.#.#.#.#.###.#.#.#########.#.#.###.###.#.#.#.#######.#.#.#.###.#.###.#.#.#.###.###.#.#.#.#
    #|#.#.#.#.#.#.#.#.#.#.#.#...#...#.....#.#.#.#...#...#.#.#.#.#...#.#.#.#.........#.#...#.#...#.#...#.......#.#.#.#...#...#.#.#.#...#.....#...#.#
    #|#.#.#.#.#.#.#.#.#.#.#.#.###.#########.#.#.###.#####.#.#.#.###.#.#.#.#.#########.###.#.#.###.#####.#######.#.#.#.#####.#.#.#.###.###########.#
    #|#.#...#...#.#.#...#.#.#...#.........#.#.#...#.....#.#.#.#.#...#.#.#.#.###...###.#...#.#...#.#.....#.....#.#.#.#.#####.#.#.#...#.#...........#
    #|#.#########.#.#####.#.###.#########.#.#.###.#####.#.#.#.#.#.###.#.#.#.###.#.###.#.###.###.#.#.#####.###.#.#.#.#.#####.#.#.###.#.#.###########
    #|#.#...#...#.#.#...#.#.#...#...#...#.#.#.#...###...#.#.#...#.#...#.#.#...#.#.#...#...#...#.#.#.#...#...#.#.#.#.#...#...#.#.#...#.#.###...#...#
    #|#.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#####.###.#.#####.#.###.#.###.#.#.#.#####.###.#.#.#.#.#.###.#.#.#.#.###.#.###.#.#.###.#.###.#.#.#.#
    #|#.#.#...#.#.#.#.#...#.#.#...#.#.#.#.#...#.#...#...#.#.....#.#...#...#...#.#...#.....#...#.#.#.#.#.#...#...#.#...#.#...#.#.#.#...#...#.#.#.#.#
    #|#.#.#####.#.#.#.#####.#.#.###.#.#.#.#####.#.#.###.#.#####.#.###.#####.###.#####.#####.###.#.#.#.#.#.#######.###.#.###.#.#.#.#.#####.#.#.#.#.#
    #|#.#.#.....#...#...#...#.#...#.#.#.#.#.....#.#.#...#...#...#...#.....#...#.....#.#...#...#...#.#.#...#.......###.#.#...#...#...#...#...#...#.#
    #|#.#.#.###########.#.###.###.#.#.#.#.#.#####.#.#.#####.#.#####.#####.###.#####.#.#.#.###.#####.#.#####.#########.#.#.###########.#.#########.#
    #|#...#...........#.#.#...#...#...#...#...###.#.#...#...#.....#.#.....#...#.....#.#.#.....#.....#.....#.......#...#.#.#...#...#...#...........#
    #|###############.#.#.#.###.#############.###.#.###.#.#######.#.#.#####.###.#####.#.#######.#########.#######.#.###.#.#.#.#.#.#.###############
    #|#...###.........#.#.#...#.......#.....#.....#.#...#.....#...#.#.....#.###.....#...#.......#...#...#.#.......#...#.#.#.#...#.#...###...#...###
    #|#.#.###.#########.#.###.#######.#.###.#######.#.#######.#.###.#####.#.#######.#####.#######.#.#.#.#.#.#########.#.#.#.#####.###.###.#.#.#.###
    #|#.#...#.........#.#...#.#.....#...###.......#.#.#.......#...#.....#.#...#...#.....#.......#.#.#.#.#.#...#.....#.#...#.....#.....#...#...#...#
    #|#.###.#########.#.###.#.#.###.#############.#.#.#.#########.#####.#.###.#.#.#####.#######.#.#.#.#.#.###.#.###.#.#########.#######.#########.#
    #|#...#.#...#...#.#.###.#.#...#.#...###...#...#...#...#...###.....#...#...#.#...#...#.......#.#...#.#...#.#...#.#...#.......#...#...#.........#
    #|###.#.#.#.#.#.#.#.###.#.###.#.#.#.###.#.#.#########.#.#.#######.#####.###.###.#.###.#######.#####.###.#.###.#.###.#.#######.#.#.###.#########
    #|#...#...#.#.#...#...#.#.#...#.#.#.#...#.#.......#...#.#...#.....#.....###...#...#...#...###.#.....###.#.###.#.#...#.#...###.#.#.#...#...#...#
    #|#.#######.#.#######.#.#.#.###.#.#.#.###.#######.#.###.###.#.#####.#########.#####.###.#.###.#.#######.#.###.#.#.###.#.#.###.#.#.#.###.#.#.#.#
    #|#.#.....#.#.......#...#.#...#.#.#.#.#...#.......#...#.#...#.....#.#.....###...#...#...#.....#.#.....#.#.#...#.#...#...#.#...#...#.....#...#.#
    #|#.#.###.#.#######.#####.###.#.#.#.#.#.###.#########.#.#.#######.#.#.###.#####.#.###.#########.#.###.#.#.#.###.###.#####.#.#################.#
    #|#.#.#...#.....###.....#.###.#.#.#.#.#.###.......#...#.#...#.....#.#.#...#...#.#...#.....#.....#...#.#.#.#...#.#...#.....#.#.........#...#...#
    #|#.#.#.#######.#######.#.###.#.#.#.#.#.#########.#.###.###.#.#####.#.#.###.#.#.###.#####.#.#######.#.#.#.###.#.#.###.#####.#.#######.#.#.#.###
    #|#.#.#.......#.#.....#.#.#...#.#.#.#.#.#...###...#.###.#...#.....#...#...#.#.#.#...#...#.#.#...#...#...#...#.#...#...#.....#.......#.#.#.#...#
    #|#.#.#######.#.#.###.#.#.#.###.#.#.#.#.#.#.###.###.###.#.#######.#######.#.#.#.#.###.#.#.#.#.#.#.#########.#.#####.###.###########.#.#.#.###.#
    #|#.#.###...#.#.#.#...#.#...#...#.#.#.#.#.#.#...#...#...#.#...#...#.......#.#.#.#.###.#.#.#.#.#.#.........#...#...#.....#.....#.....#...#...#.#
    #|#.#.###.#.#.#.#.#.###.#####.###.#.#.#.#.#.#.###.###.###.#.#.#.###.#######.#.#.#.###.#.#.#.#.#.#########.#####.#.#######.###.#.###########.#.#
    #|#.#.#...#...#...#...#.....#.#...#.#.#.#.#.#...#...#.#...#.#...#...#.....#.#.#.#...#.#.#.#.#.#.#.....#...#.....#...#.....###.#...........#...#
    #|#.#.#.#############.#####.#.#.###.#.#.#.#.###.###.#.#.###.#####.###.###.#.#.#.###.#.#.#.#.#.#.#.###.#.###.#######.#.#######.###########.#####
    #|#.#.#...#.......#...#...#.#.#...#.#.#.#.#.###...#.#.#.###.....#.###...#.#.#.#.#...#.#.#.#.#.#.#...#.#...#...#...#...#.....#.#...#.......#...#
    #|#.#.###.#.#####.#.###.#.#.#.###.#.#.#.#.#.#####.#.#.#.#######.#.#####.#.#.#.#.#.###.#.#.#.#.#.###.#.###.###.#.#.#####.###.#.#.#.#.#######.#.#
    #|#.#.###...#.....#.....#...#.....#...#.#.#...#...#.#.#.#...#...#.#...#.#.#.#...#...#.#.#.#.#.#...#.#.#...#...#.#.#...#...#.#...#...#.......#.#
    #|#.#.#######.#########################.#.###.#.###.#.#.#.#.#.###.#.#.#.#.#.#######.#.#.#.#.#.###.#.#.#.###.###.#.#.#.###.#.#########.#######.#
    #|#.#.#.......#.....#...#...#.....#...#...###.#.###.#.#.#.#...###.#.#.#.#.#.....#...#.#...#.#.#...#.#.#.###.....#...#.#...#...#.....#...#.....#
    #|#.#.#.#######.###.#.#.#.#.#.###.#.#.#######.#.###.#.#.#.#######.#.#.#.#.#####.#.###.#####.#.#.###.#.#.#############.#.#####.#.###.###.#.#####
    #|#...#.........###...#...#...###...#.......#.#...#.#.#.#.....#...#.#...#.#...#.#...#...#...#.#.....#...#.............#.#.....#.#...#...#.....#
    #|#########################################.#.###.#.#.#.#####.#.###.#####.#.#.#.###.###.#.###.###########.#############.#.#####.#.###.#######.#
    #|#.........................#...............#.....#...#.#.....#...#.....#.#.#.#.#...#...#...#...#.......#...............#...#...#...#.#.......#
    #|#.#######################.#.#########################.#.#######.#####.#.#.#.#.#.###.#####.###.#.#####.###################.#.#####.#.#.#######
    #|#.......#...#...#.......#.#.#.................#.......#.......#.#...#.#.#.#.#.#...#.#...#.#...#.#...#...........#...#...#...#...#...#.......#
    #|#######.#.#.#.#.#.#####.#.#.#.###############.#.#############.#.#.#.#.#.#.#.#.###.#.#.#.#.#.###.#.#.###########.#.#.#.#.#####.#.###########.#
    #|#...###...#...#.#.#...#.#.#...#.........#.....#.....#.........#.#.#...#.#.#...#...#...#.#.#...#...#.......#...#...#.#.#.#.....#...........#.#
    #|#.#.###########.#.#.#.#.#.#####.#######.#.#########.#.#########.#.#####.#.#####.#######.#.###.###########.#.#.#####.#.#.#.###############.#.#
    #|#.#.#...#.......#.#.#...#.......#.....#.#.....#.....#.......#...#.#.....#...#...#.....#.#.#...#.....#...#...#.....#.#.#.#.............#...#.#
    #|#.#.#.#.#.#######.#.#############.###.#.#####.#.###########.#.###.#.#######.#.###.###.#.#.#.###.###.#.#.#########.#.#.#.#############.#.###.#
    #|#.#...#.#.........#.#...#.........#...#.......#.....#...#...#.#...#...###E#.#...#...#.#.#...###...#.#.#.....#.....#...#.........#...#.#...#.#
    #|#.#####.###########.#.#.#.#########.###############.#.#.#.###.#.#####.###.#.###.###.#.#.#########.#.#.#####.#.#################.#.#.#.###.#.#
    #|#...#...#...#.......#.#.#.#.........#...#...#...#...#.#.#...#.#.#.....###.#.#...#...#...#...#...#.#...#...#...#...#...#.......#.#.#...###...#
    #|###.#.###.#.#.#######.#.#.#.#########.#.#.#.#.#.#.###.#.###.#.#.#.#######.#.#.###.#######.#.#.#.#.#####.#.#####.#.#.#.#.#####.#.#.###########
    #|#...#.#...#...#.......#.#.#...........#...#...#.#...#.#.#...#.#.#.#...###.#.#...#.#.......#...#...#.....#.......#...#...#.....#.#...........#
    #|#.###.#.#######.#######.#.#####################.###.#.#.#.###.#.#.#.#.###.#.###.#.#.###############.#####################.#####.###########.#
    #|#...#.#.........#...###...#.......#...#.........###.#.#.#.###.#.#...#.###...###...#...#.......#.....#.......#.............###...#.....#.....#
    #|###.#.###########.#.#######.#####.#.#.#.###########.#.#.#.###.#.#####.###############.#.#####.#.#####.#####.#.###############.###.###.#.#####
    #|#...#.#.........#.#.#...###.....#.#.#.#...........#.#.#.#...#.#.#.....#########...###...#...#...#...#.....#...#...###...#...#.....###...#...#
    #|#.###.#.#######.#.#.#.#.#######.#.#.#.###########.#.#.#.###.#.#.#.#############.#.#######.#.#####.#.#####.#####.#.###.#.#.#.#############.#.#
    #|#...#.#...#...#...#.#.#.#.....#.#...#.........#...#...#.#...#.#.#.###########...#...#.....#.......#.....#.......#.....#...#...............#.#
    #|###.#.###.#.#.#####.#.#.#.###.#.#############.#.#######.#.###.#.#.###########.#####.#.#################.###################################.#
    #|#...#...#...#.....#.#.#.#...#.#.............#.#.###...#...#...#.#.###########.....#.#.......#.........#.#.........#.........................#
    #|#.#####.#########.#.#.#.###.#.#############.#.#.###.#.#####.###.#.###############.#.#######.#.#######.#.#.#######.#.#########################
    #|#.#...#...#.......#.#.#.#...#...........#...#.#.....#.....#...#.#.###########.....#...#.....#.###.....#...#...###...#.......#...#...###...###
    #|#.#.#.###.#.#######.#.#.#.#############.#.###.###########.###.#.#.###########.#######.#.#####.###.#########.#.#######.#####.#.#.#.#.###.#.###
    #|#...#...#.#.......#...#...#...........#.#...#.#.....#...#...#.#.#.###########.....#...#.....#...#.#...#...#.#.#.....#.#...#...#...#.....#...#
    #|#######.#.#######.#########.#########.#.###.#.#.###.#.#.###.#.#.#.###############.#.#######.###.#.#.#.#.#.#.#.#.###.#.#.#.#################.#
    #|#...#...#.........#...#...#.#.........#.....#.#...#.#.#.#...#.#.#.#####...........#.....###.....#.#.#...#...#.#.#...#.#.#...........#...#...#
    #|#.#.#.#############.#.#.#.#.#.###############.###.#.#.#.#.###.#.#.#####.###############.#########.#.#########.#.#.###.#.###########.#.#.#.###
    #|#.#.#.....#...#.....#.#.#.#.#.#.............#.#...#...#...###.#.#S#####...............#...#.....#...#...#.....#.#.....#...........#.#.#.#...#
    #|#.#.#####.#.#.#.#####.#.#.#.#.#.###########.#.#.#############.#.#####################.###.#.###.#####.#.#.#####.#################.#.#.#.###.#
    #|#.#.......#.#.#.#.....#.#.#.#.#.#...........#...#...#...#...#...#.....###...###...###...#.#...#.#...#.#...#...#.#.............#...#.#.#...#.#
    #|#.#########.#.#.#.#####.#.#.#.#.#.###############.#.#.#.#.#.#####.###.###.#.###.#.#####.#.###.#.#.#.#.#####.#.#.#.###########.#.###.#.###.#.#
    #|#.........#.#...#.......#...#...#.................#.#.#...#...###...#.#...#.#...#.......#.#...#...#...#.....#...#.#.........#...###...###...#
    #|#########.#.#######################################.#.#######.#####.#.#.###.#.###########.#.###########.#########.#.#######.#################
    #|#...###...#.#...............#...........#...........#.#.......#...#.#.#...#.#.....#.....#.#.............#...#...#...#...#...###...#.........#
    #|#.#.###.###.#.#############.#.#########.#.###########.#.#######.#.#.#.###.#.#####.#.###.#.###############.#.#.#.#####.#.#.#####.#.#.#######.#
    #|#.#.....#...#.....#...#...#...#.....###...#.........#.#.....###.#.#.#.....#...###.#...#.#.......#.........#...#.#.....#...#...#.#.#...#...#.#
    #|#.#######.#######.#.#.#.#.#####.###.#######.#######.#.#####.###.#.#.#########.###.###.#.#######.#.#############.#.#########.#.#.#.###.#.#.#.#
    #|#.#...#...#.......#.#...#.......#...#.......#.....#...#.....#...#...#...#...#.#...#...#...#...#...#...#.....#...#...........#...#.###.#.#...#
    #|#.#.#.#.###.#######.#############.###.#######.###.#####.#####.#######.#.#.#.#.#.###.#####.#.#.#####.#.#.###.#.###################.###.#.#####
    #|#.#.#...###.........#.....#...###...#.#.......###.......#...#.........#...#.#.#.#...#...#...#.#...#.#...#...#.#.....#.......#...#.....#.....#
    #|#.#.#################.###.#.#.#####.#.#.#################.#.###############.#.#.#.###.#.#####.#.#.#.#####.###.#.###.#.#####.#.#.###########.#
    #|#...#.........###...#...#...#.....#...#.............#.....#.#...#...###...#.#.#...###.#...#...#.#.#.#.....###...#...#...###...#.....#.......#
    #|#####.#######.###.#.###.#########.#################.#.#####.#.#.#.#.###.#.#.#.#######.###.#.###.#.#.#.###########.#####.###########.#.#######
    #|#...#.......#.....#.#...#...#...#.#...#...#.........#.#.....#.#.#.#...#.#...#.......#.#...#.....#...#.........###.......#...###...#...###...#
    #|#.#.#######.#######.#.###.#.#.#.#.#.#.#.#.#.#########.#.#####.#.#.###.#.###########.#.#.#####################.###########.#.###.#.#######.#.#
    #|#.#.#...###.......#.#.....#...#.#...#...#...#...#...#.#.#...#.#.#...#.#...#.........#.#.#...#...............#.......#...#.#.#...#...#...#.#.#
    #|#.#.#.#.#########.#.###########.#############.#.#.#.#.#.#.#.#.#.###.#.###.#.#########.#.#.#.#.#############.#######.#.#.#.#.#.#####.#.#.#.#.#
    #|#.#.#.#.#...#...#.#...#.....###...........###.#.#.#.#.#.#.#.#.#...#.#.###.#.....#...#.#.#.#.#.............#.........#.#.#.#.#.#.....#.#...#.#
    #|#.#.#.#.#.#.#.#.#.###.#.###.#############.###.#.#.#.#.#.#.#.#.###.#.#.###.#####.#.#.#.#.#.#.#############.###########.#.#.#.#.#.#####.#####.#
    #|#.#.#.#.#.#.#.#...#...#...#.#.............#...#...#.#.#...#.#.#...#.#.#...#.....#.#.#.#...#...........#...#...#...###.#.#.#...#.......#.....#
    #|#.#.#.#.#.#.#.#####.#####.#.#.#############.#######.#.#####.#.#.###.#.#.###.#####.#.#.###############.#.###.#.#.#.###.#.#.#############.#####
    #|#.#.#.#.#.#.#.....#.#...#.#...#...........#...#...#.#.#...#...#...#.#.#...#.#...#.#.#.#...#.........#.#.....#...#.....#...#...#.........#...#
    #|#.#.#.#.#.#.#####.#.#.#.#.#####.#########.###.#.#.#.#.#.#.#######.#.#.###.#.#.#.#.#.#.#.#.#.#######.#.#####################.#.#.#########.#.#
    #|#.#...#...#.....#.#...#...#...#.###.......#...#.#...#...#.#...#...#.#.#...#.#.#.#.#.#...#...#.....#.#.......................#.#.#.......#.#.#
    #|#.#############.#.#########.#.#.###.#######.###.#########.#.#.#.###.#.#.###.#.#.#.#.#########.###.#.#########################.#.#.#####.#.#.#
    #|#.#...#...#...#...#...#...#.#.#.#...#...###...#...#.....#.#.#...#...#.#...#.#.#...#...#.....#...#.#...............#.........#.#...#.....#.#.#
    #|#.#.#.#.#.#.#.#####.#.#.#.#.#.#.#.###.#.#####.###.#.###.#.#.#####.###.###.#.#.#######.#.###.###.#.###############.#.#######.#.#####.#####.#.#
    #|#.#.#.#.#...#.....#.#.#.#.#.#...#.....#.#.....#...#...#.#.#.....#...#.#...#.#.#.......#...#.....#.#.........#...#...#...#...#.#...#.......#.#
    #|#.#.#.#.#########.#.#.#.#.#.###########.#.#####.#####.#.#.#####.###.#.#.###.#.#.#########.#######.#.#######.#.#.#####.#.#.###.#.#.#########.#
    #|#.#.#...#...#.....#.#...#...###.........#...#...###...#.#.#.....#...#.#.#...#.#...#.....#.......#.#.......#...#.......#...#...#.#.#.....#...#
    #|#.#.#####.#.#.#####.###########.###########.#.#####.###.#.#.#####.###.#.#.###.###.#.###.#######.#.#######.#################.###.#.#.###.#.###
    #|#...###...#...#...#.#...........#...#...###.#.#...#...#.#.#.#...#...#.#.#.###.#...#.#...#...###.#.#...###.................#.#...#.#.###.#...#
    #|#######.#######.#.#.#.###########.#.#.#.###.#.#.#.###.#.#.#.#.#.###.#.#.#.###.#.###.#.###.#.###.#.#.#.###################.#.#.###.#.###.###.#
    #|#.......#...#...#...#...#...#.....#.#.#.#...#.#.#.....#.#.#.#.#.#...#.#.#.#...#.#...#...#.#.#...#...#.#.......#...........#...###.#...#.#...#
    #|#.#######.#.#.#########.#.#.#.#####.#.#.#.###.#.#######.#.#.#.#.#.###.#.#.#.###.#.#####.#.#.#.#######.#.#####.#.#################.###.#.#.###
    #|#.#.....#.#.#.#.......#...#...#.....#.#.#.#...#...###...#.#.#.#.#.#...#.#.#...#.#.....#.#.#.#.#.......#.....#.#.............#...#.....#.#...#
    #|#.#.###.#.#.#.#.#####.#########.#####.#.#.#.#####.###.###.#.#.#.#.#.###.#.###.#.#####.#.#.#.#.#.###########.#.#############.#.#.#######.###.#
    #|#...#...#.#...#.....#.........#...#...#.#.#.#...#...#...#.#.#.#...#...#.#.#...#...#...#.#.#...#.#.....#.....#.#...#.......#...#.###...#.....#
    #|#####.###.#########.#########.###.#.###.#.#.#.#.###.###.#.#.#.#######.#.#.#.#####.#.###.#.#####.#.###.#.#####.#.#.#.#####.#####.###.#.#######
    #|###...#...###...###.....#...#.....#.###...#.#.#...#...#.#.#.#...#.....#.#.#.###...#.#...#.#.....#.#...#.....#.#.#.#...###.......#...#...#...#
    #|###.###.#####.#.#######.#.#.#######.#######.#.###.###.#.#.#.###.#.#####.#.#.###.###.#.###.#.#####.#.#######.#.#.#.###.###########.#####.#.#.#
    #|#...#...#...#.#.#.......#.#...#...#.......#.#.#...#...#.#.#.#...#.#...#.#.#.#...#...#.#...#.#...#.#...#.....#.#.#...#.............#...#...#.#
    #|#.###.###.#.#.#.#.#######.###.#.#.#######.#.#.#.###.###.#.#.#.###.#.#.#.#.#.#.###.###.#.###.#.#.#.###.#.#####.#.###.###############.#.#####.#
    #|#...#.#...#...#...#...#...###.#.#.#...#...#.#.#...#...#.#.#.#.###.#.#.#.#.#.#...#.#...#.###...#.#.#...#.....#.#...#...#...#.....#...#.#.....#
    #|###.#.#.###########.#.#.#####.#.#.#.#.#.###.#.###.###.#.#.#.#.###.#.#.#.#.#.###.#.#.###.#######.#.#.#######.#.###.###.#.#.#.###.#.###.#.#####
    #|#...#.#.#...#...#...#.#.#.....#.#.#.#...#...#.#...#...#.#.#.#...#.#.#.#.#.#.#...#.#...#.......#.#.#.#...#...#.....###...#.#...#.#.###.#.....#
    #|#.###.#.#.#.#.#.#.###.#.#.#####.#.#.#####.###.#.###.###.#.#.###.#.#.#.#.#.#.#.###.###.#######.#.#.#.#.#.#.###############.###.#.#.###.#####.#
    #|#...#.#...#.#.#.#...#...#.#...#.#.#.....#.....#...#...#.#.#.#...#...#...#...#.#...#...#.......#...#...#.#.........#.....#.#...#.#...#.#.....#
    #|###.#.#####.#.#.###.#####.#.#.#.#.#####.#########.###.#.#.#.#.###############.#.###.###.###############.#########.#.###.#.#.###.###.#.#.#####
    #|#...#.#.....#.#.#...#.....#.#.#.#.#...#.......#...#...#.#.#.#.#.......#.......#...#...#.....###...###...#.........#.#...#.#...#.#...#.#.....#
    #|#.###.#.#####.#.#.###.#####.#.#.#.#.#.#######.#.###.###.#.#.#.#.#####.#.#########.###.#####.###.#.###.###.#########.#.###.###.#.#.###.#####.#
    #|#.....#.....#.#.#.#...#.....#.#.#.#.#.#.......#...#...#.#.#.#...#.....#.....#...#.###.....#.....#...#...#...#.......#.###.#...#...###.#...#.#
    #|###########.#.#.#.#.###.#####.#.#.#.#.#.#########.###.#.#.#.#####.#########.#.#.#.#######.#########.###.###.#.#######.###.#.#########.#.#.#.#
    #|#.......#...#.#.#.#...#.#.....#.#.#.#.#.........#.#...#.#.#.....#.....###...#.#.#.#.......#.....#...###...#.#.#.....#...#...#.........#.#...#
    #|#.#####.#.###.#.#.###.#.#.#####.#.#.#.#########.#.#.###.#.#####.#####.###.###.#.#.#.#######.###.#.#######.#.#.#.###.###.#####.#########.#####
    #|#.....#.#.....#...#...#.#...#...#...#...#.....#.#.#...#.#.....#.....#.#...#...#.#.#...#...#.###.#...#.....#...#...#...#...###.........#.....#
    #|#####.#.###########.###.###.#.#########.#.###.#.#.###.#.#####.#####.#.#.###.###.#.###.#.#.#.###.###.#.###########.###.###.###########.#####.#
    #|###...#...#...###...#...###.#.#.........#.###...#...#.#...#...###...#.#...#...#.#.#...#.#.#.#...#...#.....#.......###...#...###...###.#.....#
    #|###.#####.#.#.###.###.#####.#.#.#########.#########.#.###.#.#####.###.###.###.#.#.#.###.#.#.#.###.#######.#.###########.###.###.#.###.#.#####
    #|#...#...#...#.....#...#.....#.#.........#.......#...#...#.#.....#...#...#.#...#.#.#...#.#...#.#...#.....#.#...........#...#.....#...#.#.....#
    #|#.###.#.###########.###.#####.#########.#######.#.#####.#.#####.###.###.#.#.###.#.###.#.#####.#.###.###.#.###########.###.#########.#.#####.#
    #|#.....#...#.....#...###...#...#.........#.....#.#.#.....#.....#...#...#.#.#.###...#...#.....#.#...#...#...#.....#...#...#.#.......#.#.#...#.#
    #|#########.#.###.#.#######.#.###.#########.###.#.#.#.#########.###.###.#.#.#.#######.#######.#.###.###.#####.###.#.#.###.#.#.#####.#.#.#.#.#.#
    #|#.........#...#.#.#.......#.###.........#...#.#.#.#.........#.....###.#.#...#...###...#.....#.#...#...#...#...#.#.#.#...#.#.....#.#.#...#.#.#
    #|#.###########.#.#.#.#######.###########.###.#.#.#.#########.#########.#.#####.#.#####.#.#####.#.###.###.#.###.#.#.#.#.###.#####.#.#.#####.#.#
    #|#.#...#...#...#.#.#...#...#.#...........#...#.#.#...#.....#.........#.#.#.....#.......#.....#.#...#...#.#.#...#.#.#.#...#.#...#.#.#.....#.#.#
    #|#.#.#.#.#.#.###.#.###.#.#.#.#.###########.###.#.###.#.###.#########.#.#.#.#################.#.###.###.#.#.#.###.#.#.###.#.#.#.#.#.#####.#.#.#
    #|#...#...#...###...###...#...#.............###...###...###...........#...#...................#.....###...#...###...#.....#...#...#.......#...#
    #|#############################################################################################################################################
  inspect!(part2(input, 100), content="1030809")
}